<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAKANAYA JAPON - PRODUCT LIST</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
    <header>
    <div class="header-container header-flex-row">
        <img src="images/logo.jpg" alt="SAKANAYA JAPON" class="logo-mini">

        <div class="title-section">
            <div class="title-with-footer">
                <h2 class="title-main-inline">PRODUCT LIST</h2>
                <span class="mini-footer">Â© 2026 SAKANAYA JAPON</span>
            </div>
            <p class="update-date-inline">UPDATE: 2026/02/15</p>
        </div>

        <div class="contact-section-inline">
            <a href="tel:016881370" class="tel-inline-text">ğŸ“ 016-881-370</a>
            <a href="https://t.me/SAKANAYAJAPON_SUPPORT" target="_blank" class="telegram-btn-mini">Telegram</a>
        </div>
    </div>
</header>

    <nav class="category-nav">
        <button class="nav-btn active" onclick="filterCategory('ALL', this)">ALL</button>
        <button class="nav-btn" onclick="filterCategory('FRESH', this)">FRESH</button>
        <button class="nav-btn" onclick="filterCategory('FROZEN', this)">FROZEN</button>
        <button class="nav-btn" onclick="filterCategory('JAPAN_FARMED', this)">JAPAN Farmed</button>
        <button class="nav-btn" onclick="filterCategory('JAPAN_FROZEN', this)">JAPAN Frozen</button>
        <button class="nav-btn" onclick="filterCategory('SAKE', this)">JAPAN Sake</button> 
        <button class="nav-btn" onclick="filterCategory('SEASONING', this)">SEASONING</button>
    </nav>

    <div class="search-area" style="max-width: 800px; margin: 10px auto; padding: 0 15px;">
        <input type="text" id="search-input" placeholder="Search product name... / å•†å“åã§æ¤œç´¢" onkeyup="applyFilters()" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 25px; outline: none; font-size: 16px; box-sizing: border-box;">
    </div>

    <div class="notice-area">
        <div class="notice-box">
            <h4>ã€ NOTICE ã€‘</h4>
            <p>
                <strong>JP:</strong><br>
                ãƒ»åœ°é­šã®é®®é­šã«é–¢ã—ã¦ã¯ã€ãè¡¨ç¤ºã¯ãƒ•ã‚£ãƒ¬ã§ã®ã”æä¾›ä¾¡æ ¼ã¨ãªã‚Šã¾ã™ã€‚
                ãƒ»å•†å“ã¯ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚„åå‰ã§çµã‚Šè¾¼ã¿ãŒå¯èƒ½ã§ã™ã€‚<br>
                ãƒ»è¨˜è¼‰ã«ãªã„è¼¸å…¥å•†å“ã¯<a href="https://t.me/+9MZ3SB5xav42YjZl" target="_blank" class="notice-link">OFFICIAL TELEGRAM</a>ã§ã‚‚ã”æ¡ˆå†…ã—ã¦ãŠã‚Šã¾ã™ã€‚
                ãƒ»åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—ã—ã¦Telegramã§ã”æ³¨æ–‡ã„ãŸã ã‘ã¾ã™ã€‚
            </p>
            <hr style="border: 0; border-top: 1px dashed #ccc; margin: 10px 0;">
            <p>
                <strong>EN:</strong><br>
                - For local fresh fish, the price shown per kg is for fillet.
                - You can filter products by category or name. <br>
                - Imported items not listed are also available on <a href="https://t.me/+9MZ3SB5xav42YjZl" target="_blank" class="notice-link">OFFICIAL TELEGRAM</a>
                â€ Simulate the total amount and order via Telegram.
            </p>
        </div>
    </div>

    <div id="product-container" class="container"></div>

    <section class="map-section">
        <h3>STORE LOCATION</h3>
        <div class="map-container">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3908.8200651872694!2d104.92023017318286!3d11.564753444162294!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x310951653c292489%3A0x20508e114c68ae7c!2z4Z6g4Z624Z6E4Z6P4Z-S4Z6a4Z644Z6H4Z6U4Z-J4Z674Z6T4oCLIFNha2FuYXlh4oCLIOKAi0phcG9u!5e0!3m2!1sja!2sjp!4v1771226834928!5m2!1sja!2sjp" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" width="100%" height="400" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </div>
    </section>

    <div id="image-modal" class="modal" onclick="closeModal()">
    <span class="close-btn">&times;</span>
    <img class="modal-content" id="modal-img">
</div>

    <div id="total-bar" class="total-bar">
        <div class="total-content">
            <span class="total-label">Estimated Total:</span>
            <span class="total-price">$ <span id="total-amount">0.00</span></span>
        </div>
        <button onclick="sendOrderTelegram()" class="order-send-btn">Order via Telegram</button>
        <p class="total-note">*Excluding Delivery Fee</p>
    </div>

    <script>
    let allProducts = [];
    let currentCategory = 'ALL';

    Papa.parse("products.csv", {
        download: true,
        header: true,
        skipEmptyLines: 'greedy', // ç©ºç™½è¡Œã‚’ã‚ˆã‚Šå¼·åŠ›ã«ç„¡è¦–ã™ã‚‹è¨­å®š
        transformHeader: function(h) { return h.trim(); },
        complete: function(results) {
            allProducts = results.data;
            displayProducts(allProducts);
        }
    });

    function filterCategory(cat, btn) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCategory = cat;
        applyFilters();
    }

    function applyFilters() {
        const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
        
        const filtered = allProducts.filter(p => {
            const matchesCategory = (currentCategory === 'ALL' || p.category === currentCategory);
            const matchesSearch = (p.name && p.name.toLowerCase().includes(searchTerm));
            return matchesCategory && matchesSearch;
        });

        displayProducts(filtered);
    }

    function displayProducts(products) {
        const container = document.getElementById('product-container');
        container.innerHTML = '';
        
        // æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã®ã¿ã«çµã‚Šè¾¼ã‚€ï¼ˆç©ºç™½å¯¾ç­–ï¼‰
        const validProducts = products.filter(p => p.name && p.name.trim() !== "" && p.code);

        if (validProducts.length === 0) {
            container.innerHTML = '<p style="text-align:center; padding: 20px;">No products found / è©²å½“å•†å“ãªã—</p>';
            return;
        }

        validProducts.forEach((p) => {
            // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
            let safeName = p.name.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            
            // ã‚³ãƒ¡ãƒ³ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆã€‚ã§æ”¹è¡Œï¼‰
            let rawComment = p.comment || '';
            let formattedComment = rawComment.replace(/ã€‚/g, 'ã€‚<br><span class="en-comment">') + '</span>';

            const isJapanese = (p.category === 'JAPAN_FARMED' || p.category === 'JAPAN_FROZEN' || p.category === 'SAKE' || p.category === 'CONDIMENT');
            const displayUnit = (p.unit || 'pic').replace('pc', 'pic');

            let unitOptions = '';
            if (p.is_fixed === "0") {
                if(parseFloat(p.w_pc) > 0) unitOptions += `<option value="${p.w_pc}">1 pic (${p.w_pc}kg)</option>`;
                if(parseFloat(p.w_fillet) > 0) unitOptions += `<option value="${p.w_fillet}">1 fillet:pack (${p.w_fillet}kg)</option>`;
                if(parseFloat(p.w_back) > 0) unitOptions += `<option value="${p.w_back}">Back side (${p.w_back}kg)</option>`;
                if(parseFloat(p.w_stomach) > 0) unitOptions += `<option value="${p.w_stomach}">Stomach side (${p.w_stomach}kg)</option>`;
            } else {
                unitOptions = `<option value="1">1 ${displayUnit}</option>`;
            }

            const card = `
                <div class="card">
                    <div class="img-wrapper">
                        <img src="${p.image ? p.image.trim() : ''}" alt="${safeName}" onclick="openModal(this.src)" style="cursor: pointer;">
                        <span class="category-tag ${p.category}">
                            <img src="images/${isJapanese ? 'jp-flag.png' : 'kh-flag.png'}" 
                                 style="width: 20px; border: 1px solid #ddd; margin-right: 6px; vertical-align: middle;">
                            ${p.category ? p.category.replace(/_/g, ' ') : ''}
                        </span>
                    </div>
                    <div class="info">
                        <span class="code">Code: ${p.code}</span>
                        <h3>${safeName}</h3>
                        <div class="comment-box">${formattedComment}</div>
                        <div class="price-size-area">
                            <p class="price" style="text-decoration: none !important;">$${Number(p.price).toLocaleString()} <span class="unit-text">/ ${displayUnit}</span></p>
                            
                            ${(p.size && p.size.trim() !== '' && p.size.toLowerCase() !== 'size') ? `<p class="size-detail">Size: ${p.size}</p>` : ''}
                            
                            <div class="calc-container">
                                <div class="calc-row">
                                    <select class="unit-select" onchange="updateTotal()">
                                        ${unitOptions}
                                    </select>
                                    <span class="times">Ã—</span>
                                    <input type="number" class="qty-input" min="0" value="0" 
                                           data-price="${p.price}" 
                                           onchange="updateTotal()" oninput="updateTotal()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += card;
        });
    }

    function updateTotal() {
        let total = 0;
        document.querySelectorAll('.card').forEach(card => {
            const select = card.querySelector('.unit-select');
            const input = card.querySelector('.qty-input');
            if (select && input) {
                const weight = parseFloat(select.value) || 0;
                const price = parseFloat(input.getAttribute('data-price')) || 0;
                const qty = parseFloat(input.value) || 0;
                total += price * weight * qty;
            }
        });
        document.getElementById('total-amount').innerText = total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        const bar = document.getElementById('total-bar');
        total > 0 ? bar.classList.add('show') : bar.classList.remove('show');
    }

    function sendOrderTelegram() {
        let message = "ã€New Order / æ³¨æ–‡ä¾é ¼ã€‘\n";
        let hasOrder = false;
        document.querySelectorAll('.card').forEach(card => {
            const qtyInput = card.querySelector('.qty-input');
            const qty = parseInt(qtyInput.value) || 0;
            if (qty > 0) {
                hasOrder = true;
                const name = card.querySelector('h3').innerText;
                const select = card.querySelector('.unit-select');
                const unitText = select.options[select.selectedIndex].text;
                message += `- ${name} / ${unitText} Ã— ${qty}\n`;
            }
        });

        if (!hasOrder) { alert("Please select items! / å•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚"); return; }
        message += `\nEstimated Total: $${document.getElementById('total-amount').innerText}\n\nPlease confirm availability.`;
        window.open(`https://t.me/SAKANAYAJAPON_SUPPORT?text=${encodeURIComponent(message)}`, '_blank');
    }

        function openModal(src) {
    if(!src || src.includes('undefined')) return; // ç”»åƒãŒãªã„å ´åˆã¯é–‹ã‹ãªã„
    const modal = document.getElementById("image-modal");
    const modalImg = document.getElementById("modal-img");
    modal.style.display = "block";
    modalImg.src = src;
}

function closeModal() {
    document.getElementById("image-modal").style.display = "none";
}
    </script>
</body>
</html>
