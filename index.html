<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAKANAYA JAPON - PRODUCT LIST</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <img src="images/logo.jpg" alt="SAKANAYA JAPON" class="logo">
            <div class="contact-area">
                <a href="tel:016881370" class="tel-link">üìû 016-881-370</a>
                <div class="btns">
                    <a href="https://t.me/SAKANAYAJAPON_SUPPORT" target="_blank" class="telegram-btn">Telegram</a>
                </div>
            </div>
            <h2 class="title-main">PRODUCT LIST</h2>
            <p class="update-date">UPDATE: 2026/01/15</p>
        </div>
    </header>

   <nav class="category-nav">
        <button class="nav-btn active" onclick="filterCategory('ALL', this)">ALL</button>
        <button class="nav-btn" onclick="filterCategory('FRESH', this)">FRESH</button>
        <button class="nav-btn" onclick="filterCategory('FROZEN', this)">FROZEN</button>
        <button class="nav-btn" onclick="filterCategory('JAPAN_FARMED', this)">JAPAN Farmed</button>
        <button class="nav-btn" onclick="filterCategory('JAPAN_FROZEN', this)">JAPAN Frozen</button>
        <button class="nav-btn" onclick="filterCategory('SAKE', this)">JAPAN Sake</button> 
    </nav>

    <div class="notice-area">
        <div class="notice-box">
            <h4>„Äê NOTICE „Äë</h4>
            <p>
                <strong>JP:</strong> ÂïÜÂìÅ„ÅØ„Ç´„ÉÜ„Ç¥„É™„Éº„Åî„Å®„Å´Áµû„ÇäËæº„Åø„ÅåÂèØËÉΩ„Åß„Åô„ÄÇÂêàË®àÈáëÈ°ç„Çí„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Åó„Å¶Telegram„Åß„ÅîÊ≥®Êñá„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÄÇ<br>
                <strong>EN:</strong> You can filter products by category. Simulate the total amount and order via Telegram.
            </p>
        </div>
    </div>

    <div id="product-container" class="container"></div>

    <section class="map-section">
        <h3>STORE LOCATION</h3>
        <div class="map-container">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3908.770622119253!2d104.918!3d11.569!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMTHCsDM0JzA4LjQiTiAxMDTCsDU1JzA0LjgiRQ!5e0!3m2!1sja!2skh!4v1642234000000!5m2!1sja!2skh" width="100%" height="400" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </div>
    </section>

    <footer>
        <p>¬© 2026 SAKANAYA JAPON</p>
    </footer>

    <div id="total-bar" class="total-bar">
        <div class="total-content">
            <span class="total-label">Estimated Total:</span>
            <span class="total-price">$ <span id="total-amount">0.00</span></span>
        </div>
        <button onclick="sendOrderTelegram()" class="order-send-btn">Order via Telegram</button>
        <p class="total-note">*Excluding Delivery Fee</p>
    </div>

    <script>
    let allProducts = [];
    Papa.parse("products.csv", {
        download: true,
        header: true,
        skipEmptyLines: true,
        transformHeader: function(h) { return h.trim(); },
        complete: function(results) {
            allProducts = results.data;
            displayProducts(allProducts);
        }
    });

    function displayProducts(products) {
        const container = document.getElementById('product-container');
        container.innerHTML = '';
        products.forEach((p) => {
            if(!p.name) return;

            let safeName = p.name.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            let formattedComment = (p.comment || '').replace(/„ÄÇ/g, '„ÄÇ<br><span class="en-comment">') + '</span>';

            // Êó•Êú¨ÂõΩÊóóÊù°‰ª∂„Çí JAPAN_FARMED „ÇíÂê´„ÇÄÂΩ¢„Å´Êõ¥Êñ∞
            const isJapanese = (p.category === 'JAPAN_FARMED' || p.category === 'JAPAN_FROZEN' || p.category === 'SAKE');

            let unitOptions = '';
            if (p.is_fixed === "0") {
                if(parseFloat(p.w_pc) > 0) unitOptions += `<option value="${p.w_pc}">1 pc (${p.w_pc}kg)</option>`;
                if(parseFloat(p.w_fillet) > 0) unitOptions += `<option value="${p.w_fillet}">1 fillet (${p.w_fillet}kg)</option>`;
                if(parseFloat(p.w_back) > 0) unitOptions += `<option value="${p.w_back}">Back side (${p.w_back}kg)</option>`;
                if(parseFloat(p.w_stomach) > 0) unitOptions += `<option value="${p.w_stomach}">Stomach side (${p.w_stomach}kg)</option>`;
            } else {
                unitOptions = `<option value="1">1 ${p.unit || 'pc'}</option>`;
            }

            const card = `
                <div class="card">
                    <div class="img-wrapper">
                        <img src="${p.image ? p.image.trim() : ''}" alt="${safeName}">
                        <span class="category-tag ${p.category}">
                            <img src="images/${isJapanese ? 'jp-flag.png' : 'kh-flag.png'}" alt="flag" style="width: 20px; border: 1px solid #fff; border-radius: 2px; margin-right: 6px;">
                            ${p.category.replace(/_/g, ' ')}
                        </span>
                    </div>
                    <div class="info">
                        <span class="code">Code: ${p.code}</span>
                        <h3>${safeName}</h3>
                        <div class="comment-box">${formattedComment}</div>
                        <div class="price-size-area">
                            <p class="price" style="text-decoration: none !important;">
                                $${Number(p.price).toLocaleString()} <span class="unit-text">/ ${p.unit || 'kg'}</span>
                            </p>
                            ${(p.size && p.size !== 'size') ? `<p class="size-detail">Size: ${p.size}</p>` : ''}
                            <div class="calc-container">
                                <div class="calc-row">
                                    <select class="unit-select" onchange="updateTotal()">
                                        ${unitOptions}
                                    </select>
                                    <span class="times">√ó</span>
                                    <input type="number" class="qty-input" min="0" value="0" 
                                           data-price="${p.price}" 
                                           onchange="updateTotal()" oninput="updateTotal()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += card;
        });
    }

    function updateTotal() {
        let total = 0;
        document.querySelectorAll('.card').forEach(card => {
            const select = card.querySelector('.unit-select');
            const input = card.querySelector('.qty-input');
            if (select && input) {
                const weight = parseFloat(select.value) || 0;
                const price = parseFloat(input.getAttribute('data-price')) || 0;
                const qty = parseFloat(input.value) || 0;
                total += price * weight * qty;
            }
        });
        document.getElementById('total-amount').innerText = total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        const bar = document.getElementById('total-bar');
        total > 0 ? bar.classList.add('show') : bar.classList.remove('show');
    }

    function sendOrderTelegram() {
        let message = "„ÄêNew Order / Ê≥®Êñá‰æùÈ†º„Äë\n";
        let hasOrder = false;
        document.querySelectorAll('.card').forEach(card => {
            const qty = parseInt(card.querySelector('.qty-input').value) || 0;
            if (qty > 0) {
                hasOrder = true;
                const name = card.querySelector('h3').innerText;
                const select = card.querySelector('.unit-select');
                const unitText = select.options[select.selectedIndex].text;
                message += `- ${name} / ${unitText} √ó ${qty}\n`;
            }
        });

        if (!hasOrder) { alert("Please select items! / ÂïÜÂìÅ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"); return; }
        message += `\nEstimated Total: $${document.getElementById('total-amount').innerText}\n\nPlease confirm availability.`;
        window.open(`https://t.me/SAKANAYAJAPON_SUPPORT?text=${encodeURIComponent(message)}`, '_blank');
    }

    function filterCategory(cat, btn) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        cat === 'ALL' ? displayProducts(allProducts) : displayProducts(allProducts.filter(p => p.category === cat));
    }
    </script>
</body>
</html>
